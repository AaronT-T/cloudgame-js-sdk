<!doctype html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" />
  <title>腾讯云-云游戏-示例demo</title>
  <style>
    * {
      padding: 0;
      margin: 0;
    }

    html,
    body {
      width: 100%;
      height: 100%;
      overflow: hidden;
      font-family: "黑体", "Microsoft YaHei", "Arial", "sans-serif";
    }
  </style>
</head>

<body>
  <div id="demo-container">
    <div id="mount-point"></div>
  </div>
  <script type="text/javascript" src="./tcg-sdk/index.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
  <script>

    const tryLock = async () => {
      // 接口调用参考 https://cloud.tencent.com/document/api/1162/40738
      
      const url = 'https://xxxx/tryLock';
      const { data } = await axios.post(url, {
        GameId: 'game-id',
        UserId: 'user-id',
        Appid: 1234567,
      });
      const { code, data: { Error } } = data;

      console.log('%c tryLock res', 'color: blue; font-size: 14px', data);

      if (code === 0) {
        await createSession();
      } else {
        // your logics
      }
    };

    const createSession = async () => {
      // 接口调用参考 https://cloud.tencent.com/document/api/1162/40740

      const url = 'https://xxxx/createSession';
      const { data } = await axios.post(url, {
        GameId: 'game-id',
        UserId: 'user-id',
        Appid: 1234567,
        ClientSession: TCGSDK.getClientSession()
      });

      console.log('%c createSession res', 'color: blue; font-size: 14px', data);
      const {code, data: {Error, ServerSession}} = data

      // 伪代码，成功后调用start 启动游戏
      if (code === 0) {
        TCGSDK.start(ServerSession);
      } else {
        // your logics
      }
    }

    // SDK 生命周期参考 https://cloud.tencent.com/document/product/1162/47435
    TCGSDK.init({
      appid: 1234567,
      mount: 'mount-point',
      showLogo: true,
      preloadTime: 0,
      debugSetting: {
        showLog: true,
      },
      // 连接成功回调
      onConnectSuccess: async (res) => {
        console.log('onConnectSuccess', res);
      },
      // 网络中断/被踢触发此回调
      onDisconnect: (res) => {
        console.log('onDisconnect', res);
      },
      onWebrtcStatusChange: (res) => {
        console.log('onWebrtcStatusChange', res);
      },
      onInitSuccess: async (res) => {
        console.log('%c onInitSuccess', 'color: red', res);

        await tryLock();
      }
    });

  </script>
</body>

</html>